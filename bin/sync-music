DIR=~/Music
MOUNT_POINT=~/mnt/walkman

# Ensure the mount point exists
mkdir -p "$MOUNT_POINT"

# Mount the MTP device
jmtpfs "$MOUNT_POINT"

# Check for mount success
if mount | grep "on $MOUNT_POINT" > /dev/null; then
  # Sync picked music for each genre with date-folder pattern
  for genre_path in "$DIR"/*/; do
    GENRE=$(basename "$genre_path")
    for date_folder in "$DIR/$GENRE/"*/; do
      DATE=$(basename "$date_folder")
      if [[ $DATE =~ ^[0-9]{4}-[0-9]{2}$ ]]; then
        TARGET_DIR="$MOUNT_POINT/SanDisk SD card/Music/$GENRE/"
        mkdir -p "$TARGET_DIR"
        
        # Perform the sync
        rsync --inplace -auvP "$date_folder" "$TARGET_DIR"
      fi
    done
  done

  # Unmount the MTP device
  fusermount -u "$MOUNT_POINT"
else
  echo "Failed to mount MTP device."
fi
