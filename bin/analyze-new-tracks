#!/bin/bash

OLDIFS=$IFS
IFS=$'\n'

# NOTATION=standard
SOURCE_DIR=~/Music/Picked/
UNSORTED_DIR=~/Music/Unsorted/

for TRACK_NAME in $(ls "${SOURCE_DIR}"); do
  SOURCE="${SOURCE_DIR}/${TRACK_NAME}"
  echo "Processing ${TRACK_NAME}"
  CAMELOT_KEY=$(keyfinder-cli -n camelot "${SOURCE}")
  STANDARD_KEY=$(keyfinder-cli -n standard "${SOURCE}")
  BPM=$(sox "${SOURCE}" -t raw -r 44100 -e float -c 1 - | bpm -m 60 -x 120 | awk '{print int($1+0.5)}')
  mv "${SOURCE}" "${UNSORTED_DIR}/${CAMELOT_KEY} ${STANDARD_KEY} ${BPM} - ${TRACK_NAME}"
done;

IFS=$OLDIFS


# TRACK=$(songrec audio-file-to-recognized-song ./Gavin\ Boyce\ -\ Haboo\ \(Original\ Mix\).wav | jq .track | jq .title,.subtitle,.genres.primary
# "Haboo"
